syntax = "proto3";

option go_package="store";

package store;

message RecordedEvent {
    bytes id = 1;
    bytes stream = 2;
    uint32 version = 3;
    string type = 4;
    bytes data = 5;
    bytes metadata = 6;
    bytes causation_id = 7;
    bytes correlation_id = 8;
    int64 added_at = 9;
}

message RecordedStream {
    bytes id = 1;
    repeated bytes events = 2;
    int64 added_at = 3;
}

message AddRequest {
    message Event {
        string type = 1;
        bytes data = 2;
        bytes metadata = 3;
        bytes causation_id = 4;
        bytes correlation_id = 5;
    }
    bytes stream = 1;
    uint32 version = 2;
    repeated Event events = 3;
}

message GetRequest {
    bytes stream = 1;
    uint32 version = 2;
    uint32 limit = 3;
}

message LogRequest {
    bytes offset = 1;
    uint32 limit = 2;
}

message StreamCountRequest {

}

message StreamCountResponse {
    uint64 count = 1;
}

message GetStreamsRequest {
    uint32 skip = 1;
    uint32 limit = 2;
}

message Stream {
    bytes id = 1;
    int64 added_at = 2;
}

message EventCountRequest {

}

message EventCountResponse {
    uint64 count = 1;
}

service EventStore {
    rpc Add(AddRequest) returns (stream RecordedEvent) {}
    rpc Get(GetRequest) returns (stream RecordedEvent) {}
    rpc Log(LogRequest) returns (stream RecordedEvent) {}
    rpc StreamCount(StreamCountRequest) returns (StreamCountResponse) {}
    rpc EventCount(EventCountRequest) returns (EventCountResponse) {}
    rpc GetStreams(GetStreamsRequest) returns (stream Stream) {} 
}